<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA-Style Radio Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000; /* Black background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden; /* Prevent body scroll if content slightly overflows */
        }
        .radio-container {
            background-color: #333333; /* Dark Grey background */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 100%;
            text-align: center;
            border: 2px solid #4a5568;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative; /* For toast positioning */
        }
        .icon-carousel {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .station-icon-faded {
            width: 80px; /* Size for direct faded neighbors */
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #4a5568; /* Darker border for faded icons */
            opacity: 0.4; /* Darker opacity for direct neighbors */
            margin: 0 10px; /* Adjust margin for more icons */
            transition: opacity 0.15s ease-in-out, transform 0.15s ease-in-out;
        }
        .station-icon-outer-faded { /* New class for outermost faded icons */
            width: 60px; /* Smaller size for outer faded icons */
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #4a5568; /* Thinner border for outer faded icons */
            opacity: 0.15; /* Even darker/more faded opacity */
            margin: 0 5px; /* Smaller margin for outer icons */
            transition: opacity 0.15s ease-in-out, transform 0.15s ease-in-out;
        }
        .station-icon {
            width: 120px; /* Main icon size */
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4299e1; /* Blue border for the current icon */
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6); /* White glow */
            opacity: 1; /* Full opacity */
            transition: opacity 0.15s ease-in-out, transform 0.15s ease-in-out;
        }
        .station-icon:hover {
            transform: scale(1.05);
        }
        .station-name-display {
            font-size: 2.5rem; /* Larger font for station name */
            font-weight: 800;
            color: #4299e1; /* Blue for active station name */
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(66, 153, 225, 0.5);
        }
        .control-button {
            background-color: #4a5568;
            color: #e2e8f0;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: none;
            outline: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px; /* Fixed width for control buttons */
            height: 50px; /* Fixed height for control buttons */
            padding: 0; /* Remove padding to center icon */
        }
        .control-button:hover {
            background-color: #636b77;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
        }
        .control-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        /* Specific styling for the play/pause button to be slightly larger */
        #play-pause-button {
            width: 80px;
        }
        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* Toast styles */
        .toast-message {
            position: absolute;
            top: 20px; /* Positioned at the top */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1000;
            white-space: nowrap;
        }
        .toast-message.show {
            opacity: 1;
            visibility: visible;
        }
        .play-icon, .pause-icon, .prev-icon, .next-icon {
            fill: white; /* White SVG icons */
            width: 24px; /* Size of the SVG icon */
            height: 24px;
        }
    </style>
</head>
<body class="antialiased">
    <div class="radio-container">
        <h1 class="text-3xl font-bold mb-6 text-blue-400">     </h1>

        <div class="icon-carousel">
            <img id="prev-prev-station-icon" src="" alt="Previous Previous Station Icon" class="station-icon-outer-faded">
            <img id="prev-station-icon" src="" alt="Previous Station Icon" class="station-icon-faded">
            <img id="current-station-icon" src="" alt="Current Station Icon" class="station-icon">
            <img id="next-station-icon" src="" alt="Next Station Icon" class="station-icon-faded">
            <img id="next-next-station-icon" src="" alt="Next Next Station Icon" class="station-icon-outer-faded">
        </div>

        <div class="mb-6">
            <p class="text-lg font-semibold mb-2">Now Playing:</p>
            <p id="current-station-name" class="station-name-display">Select a Station</p>
        </div>

        <audio id="radio-audio" class="w-full mb-6 hidden" controls></audio>

        <div class="flex items-center justify-center gap-4 w-full">
            <button id="prev-button" class="control-button">
                <svg class="prev-icon" viewBox="0 0 24 24">
                    <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"/>
                </svg>
            </button>
            <button id="play-pause-button" class="control-button">
                <svg id="play-icon" class="play-icon" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <svg id="pause-icon" class="pause-icon hidden" viewBox="0 0 24 24">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                </svg>
            </button>
            <button id="next-button" class="control-button">
                <svg class="next-icon" viewBox="0 0 24 24">
                    <path d="M8.59 16.59L13.17 12l-4.58-4.59L10 6l6 6-6 6z"/>
                </svg>
            </button>
        </div>

        <div id="toast-message" class="toast-message"></div>

    </div>

    <script>
        // Define your radio stations here.
        // IMPORTANT: Replace 'path/to/your/audio.mp3' with actual paths to your MP3 files.
        // Also, add 'icon' paths for your station logos.
        const radioStations = [
            { name: 'The Beat 102.7', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', icon: 'https://placehold.co/120x120/FF5733/FFFFFF?text=Beat' },
            { name: 'The Classics 104.1', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3', icon: 'https://placehold.co/120x120/33FF57/000000?text=Classics' },
            { name: 'Electro-Choc Fusion FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3', icon: 'https://placehold.co/120x120/3357FF/FFFFFF?text=ECFFM' },
            { name: 'International Funk 99', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3', icon: 'https://placehold.co/120x120/F4FF33/000000?text=IF99' },
            { name: 'Independence FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3', icon: 'https://placehold.co/120x120/8D33FF/FFFFFF?text=Indie' },
            { name: 'Integrity 2.0', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3', icon: 'https://placehold.co/120x120/FF338D/000000?text=Int2.0' },
            { name: 'Jazz Nation Radio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', icon: 'https://placehold.co/120x120/33FFB5/000000?text=JNR' },
            { name: 'The Journey', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3', icon: 'https://placehold.co/120x120/FF8D33/FFFFFF?text=Journey' },
            { name: 'K109 The Studio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3', icon: 'https://placehold.co/120x120/33A8FF/000000?text=K109' },
            { name: 'Liberty City Hardcore', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3', icon: 'https://placehold.co/120x120/8DFF33/000000?text=LCH' },
            { name: 'Liberty Rock Radio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3', icon: 'https://placehold.co/120x120/FF33F4/FFFFFF?text=LRR' },
            { name: 'Massive B Soundsystem', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3', icon: 'https://placehold.co/120x120/33FF57/000000?text=MassiveB' },
            { name: 'Public Liberty Radio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', icon: 'https://placehold.co/120x120/5733FF/FFFFFF?text=PLR' },
            { name: 'Radio Broker', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3', icon: 'https://placehold.co/120x120/FF3333/FFFFFF?text=Broker' },
            { name: 'RamJam FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3', icon: 'https://placehold.co/120x120/33FFF4/000000?text=RamJam' },
            { name: 'San Juan Sounds', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3', icon: 'https://placehold.co/120x120/FFBB33/000000?text=SJS' },
            { name: 'Self-Actualization FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3', icon: 'https://placehold.co/120x120/338DFF/FFFFFF?text=SAFM' },
            { name: 'Tuff Gong Radio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3', icon: 'https://placehold.co/120x120/FF33BB/000000?text=TGR' },
            { name: 'The Vibe', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', icon: 'https://placehold.co/120x120/33FF8D/000000?text=Vibe' },
            { name: 'Vice City FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3', icon: 'https://placehold.co/120x120/BB33FF/FFFFFF?text=VCFM' },
            { name: 'Vladivostok FM', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3', icon: 'https://placehold.co/120x120/33BBFF/000000?text=VFM' },
            { name: 'WKTT Radio', src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3', icon: 'https://placehold.co/120x120/FF3333/FFFFFF?text=WKTT' }
        ];

        // Get references to DOM elements
        const audio = document.getElementById('radio-audio');
        const currentStationNameDisplay = document.getElementById('current-station-name');
        const currentStationIconDisplay = document.getElementById('current-station-icon');
        const prevStationIconDisplay = document.getElementById('prev-station-icon');
        const nextStationIconDisplay = document.getElementById('next-station-icon');
        const prevPrevStationIconDisplay = document.getElementById('prev-prev-station-icon');
        const nextNextStationIconDisplay = document.getElementById('next-next-station-icon');
        const playPauseButton = document.getElementById('play-pause-button');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const toastMessageElement = document.getElementById('toast-message');
        const radioContainer = document.querySelector('.radio-container');

        let currentStationIndex = -1;
        let loadingStationIndex = -1;
        const audioCache = new Map();

        let toastTimeout;
        function showToast(message, duration = 2000) {
            console.log("Showing toast:", message);
            clearTimeout(toastTimeout);
            toastMessageElement.textContent = message;
            toastMessageElement.classList.add('show');
            toastTimeout = setTimeout(() => {
                toastMessageElement.classList.remove('show');
            }, duration);
        }

        function getOrCreateAudioElement(index) {
            if (index < 0 || index >= radioStations.length) {
                return null;
            }

            if (audioCache.has(index)) {
                return audioCache.get(index);
            }

            const station = radioStations[index];
            const newAudio = new Audio(station.src);
            newAudio.preload = 'auto';
            audioCache.set(index, newAudio);

            const current = currentStationIndex;
            const effectiveCurrent = current !== -1 ? current : 0;

            // Define the indices for the 5 visible slots
            const indicesToKeep = new Set([
                effectiveCurrent,
                (effectiveCurrent - 1 + radioStations.length) % radioStations.length,
                (effectiveCurrent + 1) % radioStations.length,
                (effectiveCurrent - 2 + radioStations.length) % radioStations.length,
                (effectiveCurrent + 2) % radioStations.length
            ]);

            audioCache.forEach((cachedAudio, key) => {
                if (!indicesToKeep.has(key)) {
                    cachedAudio.pause();
                    cachedAudio.src = '';
                    audioCache.delete(key);
                }
            });

            return newAudio;
        }

        function preloadNeighbors(currentIndex) {
            if (radioStations.length < 1) return;

            const indicesToPreload = [
                (currentIndex - 1 + radioStations.length) % radioStations.length,
                (currentIndex + 1) % radioStations.length,
                (currentIndex - 2 + radioStations.length) % radioStations.length,
                (currentIndex + 2) % radioStations.length
            ];

            indicesToPreload.forEach(index => {
                const audioToPreload = getOrCreateAudioElement(index);
                if (audioToPreload && audioToPreload.readyState < 2) {
                    audioToPreload.load();
                }
            });
        }

        function updateIconCarousel(index) {
            if (radioStations.length === 0) {
                currentStationIconDisplay.src = "https://placehold.co/120x120/4299e1/ffffff?text=Icon";
                currentStationIconDisplay.alt = "Station Icon";
                prevStationIconDisplay.src = "https://placehold.co/80x80/6B7280/FFFFFF?text=Prev";
                nextStationIconDisplay.src = "https://placehold.co/80x80/6B7280/FFFFFF?text=Next";
                prevPrevStationIconDisplay.src = "https://placehold.co/60x60/6B7280/FFFFFF?text=P-P";
                nextNextStationIconDisplay.src = "https://placehold.co/60x60/6B7280/FFFFFF?text=N-N";
                prevStationIconDisplay.style.opacity = '0.6';
                nextStationIconDisplay.style.opacity = '0.6';
                currentStationIconDisplay.style.opacity = '1';
                prevPrevStationIconDisplay.style.opacity = '0.15';
                nextNextStationIconDisplay.style.opacity = '0.15';
                return;
            }

            const getCircularIndex = (i) => (i + radioStations.length) % radioStations.length;

            let displayIndex = index === -1 ? 0 : index;

            let prevPrevIndex = getCircularIndex(displayIndex - 2);
            let prevIndex = getCircularIndex(displayIndex - 1);
            let nextIndex = getCircularIndex(displayIndex + 1);
            let nextNextIndex = getCircularIndex(displayIndex + 2);

            prevPrevStationIconDisplay.src = radioStations[prevPrevIndex].icon;
            prevPrevStationIconDisplay.alt = `${radioStations[prevPrevIndex].name} Icon`;

            prevStationIconDisplay.src = radioStations[prevIndex].icon;
            prevStationIconDisplay.alt = `${radioStations[prevIndex].name} Icon`;

            currentStationIconDisplay.src = radioStations[displayIndex].icon;
            currentStationIconDisplay.alt = `${radioStations[displayIndex].name} Icon`;

            nextStationIconDisplay.src = radioStations[nextIndex].icon;
            nextStationIconDisplay.alt = `${radioStations[nextIndex].name} Icon`;

            nextNextStationIconDisplay.src = radioStations[nextNextIndex].icon;
            nextNextStationIconDisplay.alt = `${radioStations[nextNextIndex].name} Icon`;
        }

        async function playStation(index) {
            if (index === currentStationIndex && !audio.paused && loadingStationIndex === -1) {
                return;
            }
            if (loadingStationIndex === index) {
                return;
            }

            if (loadingStationIndex !== -1 && loadingStationIndex !== index) {
                audio.pause();
                audio.src = '';
                audio.load();
                audio.removeEventListener('loadedmetadata', audio._currentLoadedMetadataHandler);
                audio.removeEventListener('error', audio._currentErrorHandler);
            }

            if (index < 0 || index >= radioStations.length) {
                console.error('Station index out of bounds:', index);
                return;
            }

            const station = radioStations[index];
            if (!station) {
                console.error('Station not found at index:', index);
                return;
            }

            loadingStationIndex = index;
            playPauseButton.disabled = true;
            prevButton.disabled = true;
            nextButton.disabled = true;

            // Show toast message for loading
            showToast(`Loading: ${station.name}...`);
            // Update current station name display immediately to show what's being loaded
            currentStationNameDisplay.textContent = station.name;
            // Update icons immediately
            updateIconCarousel(index);

            // Set play icon immediately as audio is not yet playing
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');

            const targetAudio = getOrCreateAudioElement(index);
            if (!targetAudio) {
                console.error("Failed to get audio element for index:", index);
                showToast(`Failed to load ${station.name}`, 3000);
                // On failure, revert name display to a neutral state or previous state if applicable
                currentStationNameDisplay.textContent = "Failed to load station";
                playPauseButton.disabled = false;
                prevButton.disabled = false;
                nextButton.disabled = false;
                loadingStationIndex = -1;
                return;
            }

            audio.src = targetAudio.src;

            const handleLoadedMetadata = async () => {
                if (loadingStationIndex !== index) {
                    console.log(`Ignoring stale onloadedmetadata for index ${index}. Current loading index is ${loadingStationIndex}.`);
                    return;
                }

                try {
                    const duration = audio.duration;
                    if (isNaN(duration) || !isFinite(duration) || duration === 0) {
                        console.error('Invalid audio duration for station:', station.name);
                        currentStationNameDisplay.textContent = `Failed to play station`; // Generic error message
                        showToast(`Error: Invalid audio duration for ${station.name}`, 3000);
                        return;
                    }

                    const randomTime = Math.random() * duration;
                    audio.currentTime = randomTime;

                    await audio.play().catch(error => {
                        console.error('Error playing station (autoplay blocked?):', station.name, error);
                        if (error.name === "NotAllowedError" || error.name === "NotSupportedError") {
                            currentStationNameDisplay.textContent = `Click Play to start!`;
                            showToast(`Autoplay blocked. Please click the Play button.`, 5000);
                        } else {
                            currentStationNameDisplay.textContent = `Failed to play station`; // Generic error message
                            showToast(`Error playing ${station.name}: ${error.message}`, 3000);
                        }
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                        playPauseButton.disabled = false;
                        prevButton.disabled = false;
                        nextButton.disabled = false;
                        throw error;
                    });

                    // Only proceed if play() was successful (no error thrown)
                    currentStationNameDisplay.textContent = station.name;
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                    currentStationIndex = index;
                    showToast(`Now Playing: ${station.name}`, 2000);

                    preloadNeighbors(currentStationIndex);

                } catch (error) {
                    console.error('Unhandled error in onloadedmetadata:', error);
                } finally {
                    playPauseButton.disabled = false;
                    prevButton.disabled = false;
                    nextButton.disabled = false;
                    loadingStationIndex = -1;
                    audio.removeEventListener('loadedmetadata', handleLoadedMetadata);
                    audio.removeEventListener('error', handleError);
                }
            };

            const handleError = () => {
                if (loadingStationIndex !== index) {
                    console.log(`Ignoring stale onerror for index ${index}. Current loading index is ${loadingStationIndex}.`);
                    return;
                }
                console.error('Error loading audio for station:', station.name);
                currentStationNameDisplay.textContent = `Failed to load station`; // Generic error message
                showToast(`Error loading ${station.name}`, 3000);
                playPauseButton.disabled = false;
                prevButton.disabled = false;
                nextButton.disabled = false;
                loadingStationIndex = -1;
                audio.removeEventListener('loadedmetadata', handleLoadedMetadata);
                audio.removeEventListener('error', handleError);
            };

            audio._currentLoadedMetadataHandler = handleLoadedMetadata;
            audio._currentErrorHandler = handleError;

            audio.addEventListener('loadedmetadata', handleLoadedMetadata);
            audio.addEventListener('error', handleError);

            audio.load();
        }

        async function togglePlayPause() {
            if (audio.paused) {
                if (currentStationIndex === -1 && radioStations.length > 0) {
                    await playStation(0);
                } else if (currentStationIndex !== -1) {
                    await audio.play().catch(error => {
                        console.error('Error resuming playback (autoplay blocked?):', radioStations[currentStationIndex].name, error);
                        if (error.name === "NotAllowedError" || error.name === "NotSupportedError") {
                            currentStationNameDisplay.textContent = `Click Play to start!`;
                            showToast(`Autoplay blocked. Please click the Play button.`, 5000);
                        } else {
                            currentStationNameDisplay.textContent = `Failed to play station`; // Generic error message
                            showToast(`Error resuming ${radioStations[currentStationIndex].name}: ${error.message}`, 3000);
                        }
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                        playPauseButton.disabled = false;
                        prevButton.disabled = false;
                        nextButton.disabled = false;
                    });
                    if (!audio.paused) {
                        playIcon.classList.add('hidden');
                        pauseIcon.classList.remove('hidden');
                        showToast(`Resumed: ${radioStations[currentStationIndex].name}`, 2000);
                    }
                }
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                if (currentStationIndex !== -1) {
                    showToast(`Paused: ${radioStations[currentStationIndex].name}`, 2000);
                }
            }
        }

        playPauseButton.addEventListener('click', togglePlayPause);

        prevButton.addEventListener('click', () => {
            if (radioStations.length === 0) {
                showToast("No stations available!", 2000);
                return;
            }
            let targetIndex;
            if (currentStationIndex === -1) {
                targetIndex = radioStations.length - 1;
            } else {
                targetIndex = (currentStationIndex - 1 + radioStations.length) % radioStations.length;
            }
            playStation(targetIndex);
        });

        nextButton.addEventListener('click', () => {
            if (radioStations.length === 0) {
                showToast("No stations available!", 2000);
                return;
            }
            let targetIndex;
            if (currentStationIndex === -1) {
                targetIndex = 0;
            } else {
                targetIndex = (currentStationIndex + 1) % radioStations.length;
            }
            playStation(targetIndex);
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'q' || event.key === 'Q') {
                event.preventDefault();
                if (radioStations.length === 0) {
                    showToast("No stations available to cycle!", 2000);
                    return;
                }

                let nextIndex;
                if (currentStationIndex === -1) {
                    nextIndex = 0;
                } else {
                    nextIndex = (currentStationIndex + 1) % radioStations.length;
                }
                playStation(nextIndex);
            }
        });

        radioContainer.addEventListener('wheel', (event) => {
            event.preventDefault();
            if (radioStations.length === 0) {
                showToast("No stations available to cycle!", 2000);
                return;
            }

            let targetIndex;
            if (event.deltaY > 0) { // Scroll down (next station)
                if (currentStationIndex === -1) {
                    targetIndex = 0;
                } else {
                    targetIndex = (currentStationIndex + 1) % radioStations.length;
                }
            } else { // Scroll up (previous station)
                if (currentStationIndex === -1) {
                    targetIndex = radioStations.length - 1;
                } else {
                    targetIndex = (currentStationIndex - 1 + radioStations.length) % radioStations.length;
                }
            }
            playStation(targetIndex);
        });

        audio.addEventListener('ended', () => {
            if (currentStationIndex !== -1) {
                playStation(currentStationIndex);
            } else {
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                currentStationNameDisplay.textContent = "Press 'Q' or Play";
                updateIconCarousel(-1);
            }
        });

        audio.addEventListener('pause', () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
        });

        audio.addEventListener('play', () => {
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
        });

        window.onload = () => {
            if (radioStations.length > 0) {
                currentStationIndex = 0;
                updateIconCarousel(currentStationIndex);
                currentStationNameDisplay.textContent = "Press 'Q' or Play";
                preloadNeighbors(currentStationIndex);
            } else {
                currentStationNameDisplay.textContent = "No stations available!";
                updateIconCarousel(-1);
            }
        };

    </script>
</body>
</html>
